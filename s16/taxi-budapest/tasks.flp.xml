<Form name="tasks" autoform="true" ksubmit="nobutton">
	<Rgsyl>
		<Syl syln="address" pctFontSize="120" />
		<Syl syln="when" halign="center" />
		<Syl syln="taskitem" duPaddingBottom="40px" />
	</Rgsyl>
	<panel name="root">
		<panel data_type="string" navigation="inline"
			generator="SELECT guid FROM REFERENCE_tasks WHERE driver=@1 AND status='Requested' LIMIT 1" ref_arg="@user" >
			<label text="Waiting for confirmation" />
		</panel>
		
		<panel  data_type="string,string,string,string,string,string"
			navigation="inline"
			generator="SELECT guid,name,address,phone,strftime('%H:%M',date),notes FROM REFERENCE_tasks WHERE driver=@1 AND status='Taken' LIMIT 1" ref_arg="@user">
			
			<panel>
				<var name="notes" label="Notes" reference="REF" ref_arg="../PARENT.col5" lines="3" />

				<table headless="true" table_width="1swt">
					<label reference="REF" ref_arg="../../PARENT.col2" sylnCrown="=address" />
					<address text="(show map)" link_target_reference="REF" link_target_ref_arg="../../PARENT.col2"/>
				</table>
	
				<table headless="true" table_width="1swt" sylnCrown="=taskitem">
					<label label="Name" reference="REF" ref_arg="../../PARENT.col1" width="remaining 1"  />
					<phone_number link_target_reference="REF" link_target_ref_arg="../../PARENT.col3" size="large" width="remaining 1" />
					<label label="When" reference="REF" ref_arg="../../PARENT.col4" width="remaining 1" sylnCrown="=when" />
				</table>
				
				<label text="Drive safely" />
				
				<var name="action" text="done" />
				<var name="guid" reference="REF" ref_arg="../PARENT.col0" />
				<closebutton action="submit_form" text="Done" width="fix 30 pt" />
			</panel>
		</panel>
		
		<panel data_type="string" navigation="inline"
			generator="SELECT '' WHERE 0 = (SELECT COUNT(*) FROM REFERENCE_tasks WHERE driver=@1 AND status IN('Requested', 'Taken') )" ref_arg="@user">
			
			<panel data_type="string,string,string,string,string,string" 
				generator="SELECT guid,name,address,phone,strftime('%H:%M',date),notes FROM REFERENCE_tasks WHERE status ='Open' " layout="standard" navigation="inline">
				
				<panel>
					<var name="notes" label="Notes" reference="REF" ref_arg="../PARENT.col5" lines="3" />
	
					<table headless="true" table_width="1swt">
						<var name="guid" reference="REF" ref_arg="../../PARENT.col0" />
						<var name="action" text="request" />
						<closebutton action="submit_form" text="Go" width="fix 30 pt" />
						
						<label reference="REF" ref_arg="../../PARENT.col2" sylnCrown="=address" />
						<address text="(show map)" link_target_reference="REF" link_target_ref_arg="../../PARENT.col2"/>
					</table>
		
					<table headless="true" table_width="1swt" sylnCrown="=taskitem">
						<label width="fix 30 pt" />
						<label label="Name" reference="REF" ref_arg="../../PARENT.col1" width="remaining 1"  />
						<phone_number link_target_reference="REF" link_target_ref_arg="../../PARENT.col3" size="large" width="remaining 1" />
						<label label="When" reference="REF" ref_arg="../../PARENT.col4" width="remaining 1" sylnCrown="=when" />
					</table>
				</panel>
				
			</panel>
		</panel>
	</panel>
</Form>