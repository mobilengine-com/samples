<form xmlns='http://schemas.mobilengine.com/fls/v2' 
	id='calendar1manu' menuName='calendar1manu' platforms='web' >
	<!-- "id", "categoryId", "dateFrom", "secondsFrom", "dateTo", "secondsTo", "label" -->
	<actionbutton text="refresh" style='{CASE WHEN cdEventsChanged THEN styles.bgGreen ELSE styles.Default END}'>
		<set value='{false}' target='cdEventsChanged'/>
	</actionbutton> 
	<table record="dummy" recordset="{SELECT 1 WHERE 3=4}" style="{[styles.tableNoSeparator]}">
		<declarations>
			<let shape='scalar' id='dtlPos' value='{nextWeekday(AddDay(dpPos1.date, -6), 1)}'/>
			<changeDetector shape='table' id='cdEvents' value='{loadNewerFromServer:SELECT e.guid id,e.guidAgent categoryId, e.dtlStart dateFrom, e.dtlEnd dateTo, e.name label FROM event e}'/>
		</declarations>
		<header>
			<row>
				<cell>
					<datepicker id="dpPos1" dateFormat='(dtf yyyy"-"MM"-"dd)' date="{sysp.dtlFormOpen}" firstDayOfWeek='monday'/>
				</cell>
				<cell>
					<actionbutton text="&lt; M">
						<set value="{addMonth(dtlPos, -1)}" target="dtlPos"/>
					</actionbutton>
				</cell>
					<cell>
					<actionbutton text="&lt; W">
						<set value="{addDay(dtlPos, -7)}" target="dtlPos"/>
					</actionbutton>
				</cell>
				<cell>
					<actionbutton text="Today!">
						<set value="{sysp.dtlFormOpen}" target="dtlPos"/>
					</actionbutton>
				</cell>
				<cell>
					<actionbutton text="&gt; W">
						<set value="{addDay(dtlPos, 7)}" target="dtlPos"/>
					</actionbutton>
				</cell>
				<cell>
					<actionbutton text="&gt; M">
						<set value="{addMonth(dtlPos, 1)}" target="dtlPos"/>
					</actionbutton>
				</cell>
			</row>
		</header>
		<row><cell><block></block></cell></row>
	</table>

	<textview style="{[styles.calHeader]}" text='{formatDtl(cal.showDate, (dtf yyyy"-"MM"-"dd)) || " - " || formatDtl(addDay(cal.showDate, 6), (dtf MM"-"dd)) || ", Week #" || toString(isoWeekOfYear(cal.showDate)) }'/>
	<table style="{[styles.tableNoSeparator, styles.tcw2x800px]}" record='r' recordset='{SELECT 1 v WHERE 1=2}'>
		<header>
			<row>
				<cell> <!-- SELECT e.guid id,e.guidAgent categoryId, e.dtlStart dateFrom, e.dtlEnd dateTo, e.name label FROM event e -->
					<calendar id="cal" events='{SELECT e.id, e.categoryId, e.dateFrom, e.dateTo, e.label FROM cdEvents e}'
						style="{[styles.calDefault, styles.calHAuto]}"
						categories='{SELECT a.guid id, a.color backgroundColor, "00000" borderColor, "00000" textColor, null selectedBackgroundColor, "FFFFFF" selectedBorderColor, null selectedTextColor FROM agent a}'
						showDate='{dtlPos}' weekends="false" startHour="8" endHour="18"/>
				</cell>
			</row>
		</header>
		<row><cell><block></block></cell></row>
	</table>

	<map points='{SELECT l.guid id, null lineId, l.lat lat, l.long lng, icons.marker icon, icons.marker_selected selectedIcon FROM location l }'
	center='{SELECT l.lat lat, l.long lng, 5 zoom FROM location l LIMIT 1}'	
	/>

</form>